function textGymSearch(){var e=$(".gym_search").val().toLowerCase().trim(),t=$("#climb-type > .option > input[name='climb-type']:checked").val();$(".gyms .option").each(function(){"True"==$(this).attr("data-"+t)&&($(this).attr("data-search-term").indexOf(e)>-1||e.length<1)?$(this).show():$(this).hide()})}function R(){$(".gym_search").val(""),textGymSearch()}function switchClimbType(e){$("#grading-system-boulder, #grading-system-route").hide(),$("#grading-system-"+e.target.value).show(),$("#grading-system-"+e.target.value+" > div > input[value=french]").prop("checked",!0),$(".gym_search").val(""),$(".gyms .option > input").each(function(){$(this).prop("checked",!1),"True"==$(this).parent().attr("data-"+e.target.value)?$(this).parent().show():$(this).parent().hide()})}function mainFormSubmit(){let e=$("#username > option:selected").text().trim(),t=$("#username > option:selected").val(),n=$("#username-gym option:selected").text();if("Select a gym first"===e||"Select your username"===e)return alert("You have to select whose stats you want to see"),!1;if(10!==t.length||isNaN(t))return alert("Something went wrong determining who you are in TopLogger"),!1;let r="",a="",i=$(".gyms input[type='checkbox']");for(let o=0;o<i.length;o++)i[o].checked&&(r+=i[o].name+",",a=i[o].value);if(0===r.length)return alert("You have to select at least one gym"),!1;loading();let s=e.split(" ")[0];e.length>11?$("#name").val(s):$("#name").val(e),climb_type=$("#climb-type > .option > input[name='climb-type']:checked").val(),grading_system=$("#grading-system-"+climb_type+" > div > input[name='grading-system']:checked").val();let m=new Date;m.setTime(m.getTime()+18e5);let l="expires="+m.toUTCString();document.cookie="climb_type="+climb_type+";"+l+";path=/;",document.cookie="grading_system="+grading_system+";"+l+";path=/;",document.cookie="gyms="+r.slice(0,-1)+";"+l+";path=/;",document.cookie="uid="+t+";"+l+";path=/;",document.cookie="name="+s+";"+l+";path=/;",$("#remember-me > input").is(":checked")&&(document.cookie="remembered="+e+":::"+t+":::"+n+";"+l+";path=/;"),-1!==r.slice(0,-1).indexOf(",")?document.location.href="/"+t:document.location.href="/"+t+"/"+a}function enableRememberMe(){$("#remember-me > input").prop("disabled",!1).removeClass("remember-me-disabled")}function selectRememberedUser(){let e=$("#remembered-users option:selected").attr("data-id");if($("#remember-me > input").prop("disabled",!0).addClass("remember-me-disabled"),"none"===e)$("#username-gym").val("Select any gym with tops (last 60 days)"),$("#username").prepend($("<option>Select a gym first</option>").prop("disabled",!0).prop("selected",!0).prop("hidden",!0).val("")),$("#remembered-users").val("Select a remembered user"),$("#username-gym").prop("disabled",!1),$("#username").prop("disabled",!0);else{$("#username-gym").prop("disabled",!0),$("#username").prop("disabled",!0);let t=e.split(":::");$("#username").prepend($("<option>"+t[0]+"</option>").prop("disabled",!0).prop("selected",!0).prop("hidden",!0).val(t[1])),$("#username-gym").prepend($("<option> "+t[2]+"</option>").prop("disabled",!0).prop("selected",!0).prop("hidden",!0).val(t[3]))}}function loading(){$("#loading").show(),$("#start-page, #popup").hide()}function replaceDirections(){window.innerWidth<=1025?($("#direction-1").text("Further down"),$("#direction-2").text("at the bottom")):($("#direction-1").text("To the right"),$("#direction-2").text("in the bottom-right corner"))}async function gymSelected(){$("#remembered-users").val("Select a remembered user"),$("#remember-me > input").prop("disabled",!0).addClass("remember-me-disabled");let e=$("#username");e.addClass("select-loading");let t=$("#username-gym option:selected").attr("name");if(t in gymsFetched)var n=gymsFetched[t];else var n=await fetchGymUsers(t);if(0==n.length){gymsFetched[t]=[],$("#username").empty(),$("#username").prepend($("<option>Select a gym first</option>").prop("selected",!0).prop("hidden",!0).val("")),$("#username").prop("disabled",!0),e.removeClass("select-loading"),alert("We couldn't find users, please select another gym");return}fillUsernames(n),gymsFetched[t]=n,e.removeClass("select-loading")}function fillUsernames(e){e.sort((e,t)=>e[1].localeCompare(t[1],void 0,{sensitivity:"base"}));let t=$("#username");t.prop("disabled",!1),t.empty(),t.append("<option selected disabled>Select your username</option>");for(let n=0;n<e.length;n++)t.append("<option value='"+e[n][0]+"'>"+e[n][1]+"</option>")}function fetchGymUsers(e,t){return fetch("/api/users/"+e).then(e=>e.ok?e.json():[]).catch(function(e){return[]})}function preloadGyms(){let e=$("#username > option:selected").val(),t=$("#username > option:selected").text().trim(),n=$("#climb-type > .option > input[name='climb-type']:checked").val(),r=$(".gyms input[type='checkbox']:checked").map(function(){return this.name}).get();if(!("Select a gym first"===t||"Select your username"===t||10!==e.length||isNaN(e))){if(0!==r.length)return fetch("/api/preload/"+e,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({climb_type:n,gym_ids:r,fp:$("#preload").attr("data-id")})})}}gymsFetched={},$(document).ready(function(e){e(".gym_search").on("keyup keydown keypress",textGymSearch),e("#climb-type").on("change","input[type='radio']",switchClimbType),e("#da-button").on("click",mainFormSubmit),replaceDirections(),window.addEventListener("resize",replaceDirections),e("#remembered-users").on("change",selectRememberedUser),e("#remembered-users").on("change",preloadGyms),e("#username").on("change",enableRememberMe),e("#username").on("change",preloadGyms),e("#username-gym").on("change",gymSelected),e(".gyms input[type='checkbox']:not(:checked)").on("change",preloadGyms)});